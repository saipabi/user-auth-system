<!DOCTYPE html>
<html>
<head>
    <title>Debug Registration</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Registration Debugging Tool</h1>
    
    <div class="test-section">
        <h2>Step 1: Test API Endpoint</h2>
        <button onclick="testEndpoint()">Test Register Endpoint</button>
        <div id="endpoint-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 2: Test Database Connection</h2>
        <button onclick="testDatabase()">Test Database</button>
        <div id="database-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 3: Test Registration</h2>
        <input type="text" id="test-username" placeholder="Username" value="testuser"><br><br>
        <input type="email" id="test-email" placeholder="Email" value=""><br><br>
        <input type="password" id="test-password" placeholder="Password" value="test123"><br><br>
        <button onclick="testRegistration()">Test Registration</button>
        <div id="register-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 4: Check Registered Users</h2>
        <button onclick="checkUsers()">Show All Users</button>
        <div id="users-result"></div>
    </div>

    <script>
        function testEndpoint() {
            fetch('register_test.php')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('endpoint-result').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                })
                .catch(e => {
                    document.getElementById('endpoint-result').innerHTML = 
                        '<p class="error">Error: ' + e.message + '</p>';
                });
        }
        
        function testDatabase() {
            fetch('check_database.php')
                .then(r => r.text())
                .then(html => {
                    document.getElementById('database-result').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById('database-result').innerHTML = 
                        '<p class="error">Error: ' + e.message + '</p>';
                });
        }
        
        function testRegistration() {
            var email = document.getElementById('test-email').value;
            if (!email) {
                email = 'test_' + Date.now() + '@test.com';
            }
            
            var formData = new FormData();
            formData.append('username', document.getElementById('test-username').value);
            formData.append('email', email);
            formData.append('password', document.getElementById('test-password').value);
            
            document.getElementById('register-result').innerHTML = '<p class="info">Registering...</p>';
            
            fetch('register.php', {
                method: 'POST',
                body: formData
            })
            .then(r => r.text())
            .then(res => {
                var response = res.trim();
                var resultDiv = document.getElementById('register-result');
                
                if (response === 'SUCCESS') {
                    resultDiv.innerHTML = '<p class="success">✓ Registration SUCCESSFUL!</p>';
                    checkUsers(); // Refresh user list
                } else {
                    resultDiv.innerHTML = '<p class="error">✗ Registration FAILED</p>' +
                        '<p><strong>Response:</strong> ' + response + '</p>';
                }
            })
            .catch(e => {
                document.getElementById('register-result').innerHTML = 
                    '<p class="error">Error: ' + e.message + '</p>';
            });
        }
        
        function checkUsers() {
            fetch('check_database.php')
                .then(r => r.text())
                .then(html => {
                    // Extract just the users table
                    var parser = new DOMParser();
                    var doc = parser.parseFromString(html, 'text/html');
                    var table = doc.querySelector('table');
                    if (table) {
                        document.getElementById('users-result').innerHTML = 
                            '<h3>Registered Users:</h3>' + table.outerHTML;
                    } else {
                        document.getElementById('users-result').innerHTML = 
                            '<p>Could not find users table. Check database.</p>';
                    }
                })
                .catch(e => {
                    document.getElementById('users-result').innerHTML = 
                        '<p class="error">Error: ' + e.message + '</p>';
                });
        }
        
        // Auto-generate email on load
        window.onload = function() {
            document.getElementById('test-email').value = 'test_' + Date.now() + '@test.com';
        };
    </script>
</body>
</html>
